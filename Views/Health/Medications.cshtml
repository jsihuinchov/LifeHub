@model List<LifeHub.Models.Entities.Medication>
@{
    ViewData["Title"] = "Mis Medicamentos";
}

<div class="health-container">
    <!-- HEADER CON NAVEGACI√ìN -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="dashboard-title">
                <i class="fas fa-pills me-2"></i>Mis Medicamentos
            </h1>
            <p class="dashboard-subtitle">Gestiona tu tratamiento y controla tu inventario</p>
        </div>
        <div class="nav-buttons">
            <a href="@Url.Action("Index", "Health")" class="btn btn-outline-primary me-2">
                <i class="fas fa-arrow-left me-1"></i>Dashboard
            </a>
            <a href="@Url.Action("CreateMedication", "Health")" class="btn btn-success">
                <i class="fas fa-plus me-1"></i>Nuevo Medicamento
            </a>
        </div>
    </div>

    <!-- ESTAD√çSTICAS R√ÅPIDAS -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="stat-card text-center">
                <div class="stat-value text-primary">@Model.Count(m => m.IsActive)</div>
                <div class="stat-label">Activos</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card text-center">
                <div class="stat-value text-warning">@Model.Count(m => m.TotalQuantity <= m.LowStockAlert && m.IsActive)</div>
                <div class="stat-label">Stock Bajo</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card text-center">
                <div class="stat-value text-info">@Model.Count(m => !m.IsActive)</div>
                <div class="stat-label">Inactivos</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card text-center">
                <div class="stat-value text-success">@Model.Sum(m => m.TotalQuantity)</div>
                <div class="stat-label">Total Unidades</div>
            </div>
        </div>
    </div>

    <!-- ALERTAS DE STOCK BAJO -->
    @{
        var lowStockMeds = Model.Where(m => m.TotalQuantity <= m.LowStockAlert && m.IsActive).ToList();
    }
    @if (lowStockMeds.Any())
    {
        <div class="alert alert-warning mb-4">
            <h6><i class="fas fa-exclamation-triangle me-2"></i>‚ö†Ô∏è Alertas de Stock Bajo</h6>
            <div class="alert-items">
                @foreach (var med in lowStockMeds)
                {
                    <div class="alert-item">
                        <strong>@med.Name</strong> - Solo quedan @med.TotalQuantity unidades
                        @if (med.TotalQuantity <= med.LowStockAlert)
                        {
                            <span class="text-danger fw-bold">¬°Stock cr√≠tico!</span>
                        }
                        <a href="@Url.Action("EditMedication", "Health", new { id = med.Id })" class="btn btn-sm btn-outline-warning ms-2">
                            <i class="fas fa-edit me-1"></i>Reponer
                        </a>
                    </div>
                }
            </div>
        </div>
    }

    <!-- LISTA DE MEDICAMENTOS -->
    <div class="card">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Lista de Medicamentos</h5>
        </div>
        <div class="card-body">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Medicamento</th>
                                <th>Dosis</th>
                                <th>Frecuencia</th>
                                <th>Stock</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var medication in Model)
                            {
                                <tr class="@(!medication.IsActive ? "table-secondary" : "")">
                                    <td>
                                        <strong>@medication.Name</strong>
                                        @if (!string.IsNullOrEmpty(medication.Notes))
                                        {
                                            <br>
                                            <small class="text-muted">@medication.Notes</small>
                                        }
                                    </td>
                                    <td>@medication.Dosage</td>
                                    <td>@medication.Frequency</td>
                                    <td>
                                        @if (medication.TotalQuantity <= medication.LowStockAlert)
                                        {
                                            <span class="badge bg-warning">@medication.TotalQuantity</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">@medication.TotalQuantity</span>
                                        }
                                        <small class="text-muted d-block">Alerta: @medication.LowStockAlert</small>
                                    </td>
                                    <td>
                                        @if (medication.IsActive)
                                        {
                                            <span class="badge bg-success">Activo</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">Inactivo</span>
                                        }
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="@Url.Action("EditMedication", "Health", new { id = medication.Id })" 
                                               class="btn btn-outline-primary" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form method="post" action="@Url.Action("ToggleMedicationStatus", "Health", new { id = medication.Id })" 
                                                  class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-outline-warning" title="@(medication.IsActive ? "Desactivar" : "Activar")">
                                                    <i class="fas @(medication.IsActive ? "fa-pause" : "fa-play")"></i>
                                                </button>
                                            </form>
                                            <form method="post" action="@Url.Action("DeleteMedication", "Health", new { id = medication.Id })" 
                                                  class="d-inline" 
                                                  onsubmit="return confirm('¬øEst√°s seguro de que quieres eliminar este medicamento?');">
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-outline-danger" title="Eliminar">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-pills fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No hay medicamentos registrados</h4>
                    <p class="text-muted mb-4">Comienza agregando tu primer medicamento</p>
                    <a href="@Url.Action("CreateMedication", "Health")" class="btn btn-success btn-lg">
                        <i class="fas fa-plus me-2"></i>Agregar Primer Medicamento
                    </a>
                </div>
            }
        </div>
    </div>

    <!-- INFORMACI√ìN ADICIONAL -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>üí° Consejos</h6>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>Mant√©n actualizado el stock de tus medicamentos</li>
                        <li>Configura alertas de stock bajo para no quedarte sin</li>
                        <li>Registra efectos secundarios en las notas</li>
                        <li>Marca como inactivos los medicamentos que ya no uses</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="fas fa-rocket me-2"></i>üöÄ Acciones R√°pidas</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("CreateMedication", "Health")" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>Agregar Medicamento
                        </a>
                        <a href="@Url.Action("Index", "Health")" class="btn btn-outline-primary">
                            <i class="fas fa-tachometer-alt me-2"></i>Volver al Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .health-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .dashboard-title {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .dashboard-subtitle {
        color: #7f8c8d;
        font-size: 1.1rem;
    }

    .nav-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #e9ecef;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
    }

    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #666;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }

    .alert-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .alert-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background: rgba(255,255,255,0.5);
        border-radius: 6px;
        border-left: 3px solid #ffc107;
    }

    .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card-header {
        border-radius: 12px 12px 0 0 !important;
        font-weight: 600;
    }

    .table th {
        border-top: none;
        font-weight: 600;
        color: #495057;
        background: #f8f9fa;
    }

    .btn-group-sm > .btn {
        padding: 0.25rem 0.5rem;
    }

    @@media (max-width: 768px) {
        .nav-buttons {
            flex-direction: column;
            width: 100%;
        }
        
        .nav-buttons .btn {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .alert-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .table-responsive {
            font-size: 0.9rem;
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
    }
</style>