@model LifeHub.Models.ViewModels.HealthDashboardViewModel
@{
    ViewData["Title"] = "Dashboard de Salud";
}

<div class="health-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">
                <i class="fas fa-heartbeat me-2"></i>Dashboard de Salud
            </h1>
            <p class="dashboard-subtitle">Gestiona tu bienestar y seguimiento médico</p>
        </div>
        <div class="header-actions">
            <a href="@Url.Action("CreateAppointment")" class="btn btn-primary me-2">
                <i class="fas fa-calendar-plus me-1"></i>Nueva Cita
            </a>
            <a href="@Url.Action("CreateMedication")" class="btn btn-success">
                <i class="fas fa-pills me-1"></i>Nuevo Medicamento
            </a>
        </div>
    </div>

    <!-- Alertas -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dashboard">
            <div class="alert-content">
                <i class="fas fa-check-circle me-2"></i>
                <span>@TempData["SuccessMessage"]</span>
            </div>
            <button type="button" class="alert-close" onclick="this.parentElement.style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dashboard">
            <div class="alert-content">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span>@TempData["ErrorMessage"]</span>
            </div>
            <button type="button" class="alert-close" onclick="this.parentElement.style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>
    }

    <!-- Estadísticas Rápidas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-card health-stats">
                <div class="stats-icon appointment-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stats-content">
                    <h3>@Model.Stats.TotalAppointments</h3>
                    <p>Citas Totales</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card health-stats">
                <div class="stats-icon upcoming-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stats-content">
                    <h3>@Model.Stats.UpcomingAppointments</h3>
                    <p>Próximas Citas</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card health-stats">
                <div class="stats-icon medication-icon">
                    <i class="fas fa-pills"></i>
                </div>
                <div class="stats-content">
                    <h3>@Model.Stats.ActiveMedications</h3>
                    <p>Medicamentos Activos</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card health-stats">
                <div class="stats-icon completed-icon">
                    <i class="fas fa-check-double"></i>
                </div>
                <div class="stats-content">
                    <h3>@Model.Stats.CompletedAppointments</h3>
                    <p>Citas Completadas</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Columna Izquierda - Próximas Citas -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-day me-2"></i>
                        Próximas Citas (7 días)
                    </h3>
                    <a href="@Url.Action("Appointments")" class="btn btn-link btn-sm">Ver Todas</a>
                </div>
                <div class="card-body">
                    @if (Model.UpcomingAppointments.Any())
                    {
                        <div class="appointments-list">
                            @foreach (var appointment in Model.UpcomingAppointments.Take(5))
                            {
                                <div class="appointment-item">
                                    <div class="appointment-icon">
                                        <i class="fas fa-stethoscope"></i>
                                    </div>
                                    <div class="appointment-content">
                                        <h5>@appointment.Title</h5>
                                        <div class="appointment-details">
                                            @if (!string.IsNullOrEmpty(appointment.DoctorName))
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-user-md me-1"></i>@appointment.DoctorName
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(appointment.Specialty))
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-briefcase-medical me-1"></i>@appointment.Specialty
                                                </span>
                                            }
                                            <span class="detail-item">
                                                <i class="fas fa-clock me-1"></i>@appointment.AppointmentDate.ToString("dd/MM/yyyy HH:mm")
                                            </span>
                                            @if (!string.IsNullOrEmpty(appointment.Location))
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-map-marker-alt me-1"></i>@appointment.Location
                                                </span>
                                            }
                                        </div>
                                    </div>
                                    <div class="appointment-actions">
                                        <a href="@Url.Action("EditAppointment", new { id = appointment.Id })" 
                                           class="btn btn-sm btn-outline-primary" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="no-data">
                            <i class="fas fa-calendar-times fa-2x mb-3"></i>
                            <h5>No hay citas próximas</h5>
                            <p class="text-muted">Programa tu próxima cita médica</p>
                            <a href="@Url.Action("CreateAppointment")" class="btn btn-primary btn-sm">
                                <i class="fas fa-plus me-1"></i>Crear Cita
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Columna Derecha - Medicamentos Activos -->
        <div class="col-lg-6">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-pills me-2"></i>
                        Medicamentos Activos
                    </h3>
                    <a href="@Url.Action("Medications")" class="btn btn-link btn-sm">Ver Todos</a>
                </div>
                <div class="card-body">
                    @if (Model.ActiveMedications.Any())
                    {
                        <div class="medications-list">
                            @foreach (var medication in Model.ActiveMedications.Take(5))
                            {
                                <div class="medication-item">
                                    <div class="medication-icon @(medication.IsActive ? "active" : "inactive")">
                                        <i class="fas fa-capsules"></i>
                                    </div>
                                    <div class="medication-content">
                                        <h5>@medication.Name</h5>
                                        <div class="medication-details">
                                            @if (!string.IsNullOrEmpty(medication.Dosage))
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-syringe me-1"></i>@medication.Dosage
                                                </span>
                                            }
                                            @if (!string.IsNullOrEmpty(medication.Frequency))
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-redo me-1"></i>@medication.Frequency
                                                </span>
                                            }
                                            @if (medication.StartDate.HasValue)
                                            {
                                                <span class="detail-item">
                                                    <i class="fas fa-play-circle me-1"></i>@medication.StartDate.Value.ToString("dd/MM/yyyy")
                                                </span>
                                            }
                                        </div>
                                    </div>
                                    <div class="medication-actions">
                                        <form method="post" action="@Url.Action("ToggleMedicationStatus", new { id = medication.Id })" 
                                              class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-sm @(medication.IsActive ? "btn-warning" : "btn-success")" 
                                                    title="@(medication.IsActive ? "Desactivar" : "Activar")">
                                                <i class="fas fa-power-off"></i>
                                            </button>
                                        </form>
                                        <a href="@Url.Action("EditMedication", new { id = medication.Id })" 
                                           class="btn btn-sm btn-outline-primary" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="no-data">
                            <i class="fas fa-pills fa-2x mb-3"></i>
                            <h5>No hay medicamentos activos</h5>
                            <p class="text-muted">Registra tus medicamentos actuales</p>
                            <a href="@Url.Action("CreateMedication")" class="btn btn-success btn-sm">
                                <i class="fas fa-plus me-1"></i>Agregar Medicamento
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-rocket me-2"></i>
                        Acciones Rápidas
                    </h3>
                </div>
                <div class="card-body">
                    <div class="quick-actions">
                        <a href="@Url.Action("CreateAppointment")" class="quick-action-item">
                            <div class="action-icon primary">
                                <i class="fas fa-calendar-plus"></i>
                            </div>
                            <span>Nueva Cita</span>
                        </a>
                        <a href="@Url.Action("CreateMedication")" class="quick-action-item">
                            <div class="action-icon success">
                                <i class="fas fa-pills"></i>
                            </div>
                            <span>Nuevo Medicamento</span>
                        </a>
                        <a href="@Url.Action("Appointments")" class="quick-action-item">
                            <div class="action-icon info">
                                <i class="fas fa-list"></i>
                            </div>
                            <span>Ver Citas</span>
                        </a>
                        <a href="@Url.Action("Medications")" class="quick-action-item">
                            <div class="action-icon warning">
                                <i class="fas fa-capsules"></i>
                            </div>
                            <span>Ver Medicamentos</span>
                        </a>
                        <a href="@Url.Action("Stats")" class="quick-action-item">
                            <div class="action-icon danger">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <span>Estadísticas</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .health-container {
        padding: 20px;
    }

    .health-stats .stats-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .appointment-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .upcoming-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .medication-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .completed-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

    .appointments-list, .medications-list {
        max-height: 400px;
        overflow-y: auto;
    }

    .appointment-item, .medication-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #eee;
        transition: background-color 0.3s;
    }

    .appointment-item:hover, .medication-item:hover {
        background-color: #f8f9fa;
    }

    .appointment-icon, .medication-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        color: white;
    }

    .appointment-icon {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .medication-icon.active {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .medication-icon.inactive {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .appointment-content, .medication-content {
        flex: 1;
    }

    .appointment-content h5, .medication-content h5 {
        margin: 0 0 5px 0;
        font-size: 1rem;
        color: #333;
    }

    .appointment-details, .medication-details {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .detail-item {
        font-size: 0.85rem;
        color: #666;
        display: flex;
        align-items: center;
    }

    .appointment-actions, .medication-actions {
        display: flex;
        gap: 5px;
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }

    .quick-action-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        text-decoration: none;
        color: #333;
        border-radius: 10px;
        transition: all 0.3s;
        border: 2px solid transparent;
    }

    .quick-action-item:hover {
        text-decoration: none;
        color: #333;
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .action-icon {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: white;
    }

    .action-icon.primary { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); }
    .action-icon.success { background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); }
    .action-icon.info { background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%); }
    .action-icon.warning { background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); }
    .action-icon.danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }

    .no-data {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .no-data i {
        margin-bottom: 15px;
    }
</style>